package com.scifilearn.controller;

import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import java.util.*;

@RestController
@RequestMapping("/api")
public class ApiController {

    private List<Map<String,Object>> books = new ArrayList<>();

    @PostMapping("/admin/books")
    public Map<String,Object> uploadBook(@RequestParam String title,
                                         @RequestParam String authors,
                                         @RequestParam MultipartFile file){
        Map<String,Object> book = new HashMap<>();
        book.put("id", UUID.randomUUID().toString());
        book.put("title", title);
        book.put("authors", Arrays.asList(authors.split(",")));
        book.put("pdfUrl", "/pdfs/"+file.getOriginalFilename());
        books.add(book);
        return book;
    }

    @PostMapping("/ai/chat")
    public Map<String,String> chat(@RequestBody Map<String,String> payload){
        String message = payload.get("message");
        // Mistral/Ollama via HTTP
        return Map.of("answer","Resposta adaptada (AI): "+message);
    }

    @GetMapping("/admin/books")
    public List<Map<String,Object>> getBooks(){
        return books;
    }
}
